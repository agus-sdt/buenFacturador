{% extends "base.html" %}

{% block title %}Ventas por Período - buenFacturador{% endblock %}

{% block page_title %}Ventas por Período{% endblock %}

{% block breadcrumb %}
<li class="breadcrumb-item"><a href="{{ url_for('dashboard') }}">Inicio</a></li>
<li class="breadcrumb-item"><a href="{{ url_for('reportes.menu_reportes') }}">Reportes</a></li>
<li class="breadcrumb-item active">Ventas por Período</li>
{% endblock %}

{% block content %}

<div class="row">
    <div class="col-12">
        <div class="card card-success">
            <div class="card-header">
                <h3 class="card-title">
                    <i class="fas fa-filter"></i> Filtros de Período
                </h3>
            </div>
            <div class="card-body">
                <form method="GET">
                    <div class="row">
                        <div class="col-md-3">
                            <div class="form-group">
                                <label for="fecha_inicio">Fecha Inicio</label>
                                <input type="date" class="form-control" id="fecha_inicio" name="fecha_inicio" 
                                        value="{{ request.args.get('fecha_inicio', '') }}">
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="form-group">
                                <label for="fecha_fin">Fecha Fin</label>
                                <input type="date" class="form-control" id="fecha_fin" name="fecha_fin"
                                        value="{{ request.args.get('fecha_fin', '') }}">
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="form-group">
                                <label for="estado">Estado</label>
                                <select class="form-control" id="estado" name="estado">
                                    <option value="">Todos</option>
                                    <option value="pendiente" {% if request.args.get('estado') == 'pendiente' %}selected{% endif %}>Pendiente</option>
                                    <option value="pagada" {% if request.args.get('estado') == 'pagada' %}selected{% endif %}>Pagada</option>
                                    <option value="anulada" {% if request.args.get('estado') == 'anulada' %}selected{% endif %}>Anulada</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="form-group">
                                <label>&nbsp;</label>
                                <div>
                                    <button type="submit" class="btn btn-success">
                                        <i class="fas fa-search"></i> Filtrar
                                    </button>
                                    <a href="{{ url_for('reportes.ventas_por_periodo') }}" class="btn btn-secondary">
                                        <i class="fas fa-times"></i> Limpiar
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

{% if datos_reporte %}

<div class="row">
    <div class="col-lg-3 col-6">
        <div class="small-box bg-info">
            <div class="inner">
                <h3>{{ datos_reporte.total_facturas }}</h3>
                <p>Total Facturas</p>
            </div>
            <div class="icon">
                <i class="fas fa-file-invoice"></i>
            </div>
        </div>
    </div>
    <div class="col-lg-3 col-6">
        <div class="small-box bg-success">
            <div class="inner">
                <h3>${{ "%.2f"|format(datos_reporte.total_ventas) }}</h3>
                <p>Total Ventas</p>
            </div>
            <div class="icon">
                <i class="fas fa-dollar-sign"></i>
            </div>
        </div>
    </div>
    <div class="col-lg-3 col-6">
        <div class="small-box bg-warning">
            <div class="inner">
                <h3>${{ "%.2f"|format(datos_reporte.promedio_diario) }}</h3>
                <p>Promedio Diario</p>
            </div>
            <div class="icon">
                <i class="fas fa-calculator"></i>
            </div>
        </div>
    </div>
    <div class="col-lg-3 col-6">
        <div class="small-box bg-danger">
            <div class="inner">
                <h3>${{ "%.2f"|format(datos_reporte.mayor_venta) }}</h3>
                <p>Mayor Venta</p>
            </div>
            <div class="icon">
                <i class="fas fa-trophy"></i>
            </div>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h3 class="card-title">
                    <i class="fas fa-list"></i> Ventas por Día
                </h3>
                <div class="card-tools">
                    <button type="button" class="btn btn-sm btn-primary" onclick="window.print()">
                        <i class="fas fa-print"></i> Imprimir
                    </button>
                </div>
            </div>
            <div class="card-body table-responsive p-0">
                <table class="table table-hover text-nowrap">
                    <thead>
                        <tr>
                            <th>Fecha</th>
                            <th class="text-center">Total Facturas</th>
                            <th class="text-center">Pendientes</th>
                            <th class="text-center">Pagadas</th>
                            <th class="text-center">Anuladas</th>
                            <th class="text-right">Total Ventas</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for periodo in datos_reporte.periodos %}
                        <tr>
                            <td><strong>{{ periodo.fecha.strftime('%d/%m/%Y') }}</strong></td>
                            <td class="text-center">
                                <span class="badge badge-primary">{{ periodo.total_facturas }}</span>
                            </td>
                            <td class="text-center">
                                <span class="badge badge-warning">{{ periodo.pendientes }}</span>
                            </td>
                            <td class="text-center">
                                <span class="badge badge-success">{{ periodo.pagadas }}</span>
                            </td>
                            <td class="text-center">
                                <span class="badge badge-danger">{{ periodo.anuladas }}</span>
                            </td>
                            <td class="text-right">
                                <strong>${{ "%.2f"|format(periodo.total_ventas) }}</strong>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                    <tfoot>
                        <tr class="bg-light">
                            <th>TOTAL</th>
                            <th class="text-center">{{ datos_reporte.total_facturas }}</th>
                            <th class="text-center">{{ datos_reporte.total_pendientes }}</th>
                            <th class="text-center">{{ datos_reporte.total_pagadas }}</th>
                            <th class="text-center">{{ datos_reporte.total_anuladas }}</th>
                            <th class="text-right">${{ "%.2f"|format(datos_reporte.total_ventas) }}</th>
                        </tr>
                    </tfoot>
                </table>
            </div>
        </div>
    </div>
</div>
{% else %}
<div class="row">
    <div class="col-12">
        <div class="card">
            <div class="card-body">
                <div class="text-center">
                    <i class="fas fa-calendar-times fa-3x text-muted mb-3"></i>
                    <h4 class="text-muted">No hay datos para el período seleccionado</h4>
                    <p class="text-muted">Selecciona un rango de fechas diferente para ver los resultados</p>
                </div>
            </div>
        </div>
    </div>
</div>
{% endif %}
{% endblock %}